---
- hosts: localhost
  connection: local
  gather_facts: false
  #  become: true
  #  become_method: sudo
  tasks:
          #    - name: Change the working directory to create demo.war using the pom.xml
      #      shell: chmod 777 /var/lib/jenkins/workspace/ansible_playbook_project_test/
      #      args:
              #        chdir: /var/lib/jenkins/workspace/ansible_playbook_project_test/

    - name: Change the working directory to create demo.war using the pom.xml
      shell: mvn clean package
      args:
        chdir: /var/lib/jenkins/workspace/ansible_playbook_project_test/

        #    - name: "Debug: List contents of the directory"
        #      shell: ls -l /var/lib/jenkins/workspace/ansible_playbook_project_test/
    - name: copy .war file to docker context folder
      copy:
        src: /var/lib/jenkins/workspace/ansible_playbook_project_test/target/demo.war
        dest: /home/labsuser/.docker/context
    
    - name: copy jenkinsDocker file to docker context folder
      copy:
        src: /var/lib/jenkins/workspace/ansible_playbook_project_test/target/jenkinsDockerfile
        dest: /home/labsuser/.docker/context

    - name: Build Docker image
      docker_image:
        name: my_auto_image
        path: ~/.docker/build/context/
